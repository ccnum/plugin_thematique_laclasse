#CACHE{0}

<?php

/************************************************************************

FRONTOFFICE / MUSIQUE.LACLASSE.COM
DÉBUT DE DÉVELOPPEMENT LE 26/08/2003
HTTP://WWW.LAVITRINEDETRAFIK.COM

ADAPTATION / FRONTOFFICE SITES THEMATIQUES
LACLASSE.COM / P. VINCENT / ERASME
JUILLET 2006

*************************************************************************
RENVOIE LA LISTE DES ARTICLES - AVEC MOT CLEF PARTICULIER
************************************************************************/

/**********************************
require pour inclure qq fonctions
**********************************/

$retour_flash = "";
$index=1;
<BOUCLE_album0(AUTEURS) {par titre} {id_auteur=100} {doublons}>

/* récupère les données dans des tableaux gère les slashes */
        $numero = $index;
        $id_article = #ID_AUTEUR;
        $titre = stripslashes(utf8_encode('#NOM'));
        $date = '#EXTRA';
        $url_article = urlencode('spip.php?page=par_auteur&id_auteur=#ID_AUTEUR');
        $logo='';
        [$logo = 'IMG/(#LOGO_AUTEUR|fichier)';]
        
        $auteur = '';
        $auteur .= stripslashes('#NOM');
        
        $fichier_image1='';
        $fichier_image2='';
        $fichier_image3='';
        $fichier_son='';
        $fichier_video='';
        $nom_image1='';
        $nom_image2='';
        $nom_image3='';
        $nom_son='';
        $nom_video='';
        
        $type = 2;
        $couleur = 1;

        <BOUCLE_art0(ARTICLES) {id_auteur} {par date} {inverse} {0,1}>
        	//$texte = str_replace("\'"," ",$texte);
        	$texte = stripslashes(wordwrap(utf8_encode("[(#TEXTE|textebrut|entites_html)]"),30));
        
	        <BOUCLE_documents0 (DOCUMENTS) {id_article} {0,3} {extension==jpg|png|gif}>
	        $type = 1;
	        $couleur = 0;
	        
	        $fichier_image#COMPTEUR_BOUCLE = stripslashes('#URL_DOCUMENT');
	        $nom_image#COMPTEUR_BOUCLE = stripslashes('#TITRE');
	        </BOUCLE_documents0>
	        
	        <BOUCLE_documents20 (DOCUMENTS) {id_article} {0,1} {extension==mp3|ogg}>
	        $type = 5;
	        $couleur = 5;
	        
	        $fichier_son = stripslashes('#URL_DOCUMENT');
	        $nom_son = stripslashes('#TITRE');
	        </BOUCLE_documents20>
	        
	        <BOUCLE_documents30 (DOCUMENTS) {id_article} {0,1} {extension==avi|mov|wmv}>
	        $type = 3;
	        $couleur = 2;
	        
	        $fichier_video = stripslashes('#URL_DOCUMENT');
	        $nom_video = stripslashes('#TITRE');
	        </BOUCLE_documents30>

        </BOUCLE_art0>

        
        /* formatage texte renvoyé à Flash */
        $retour_flash .= "id_$numero=$numero&";
        $retour_flash .= "id_article_$numero=$id_article&";
        $retour_flash .= "auteur_$numero=$auteur&";
        $retour_flash .= "titre_$numero=$titre&";
        $retour_flash .= "type_$numero=$type&";
        $retour_flash .= "couleur_$numero=$couleur&";
        $retour_flash .= "date_$numero=$date&";
        $retour_flash .= "fichier_son_$numero=$fichier_son&";
        $retour_flash .= "nom_son_$numero=$nom_son&";        
        $retour_flash .= "fichier_video_$numero=$fichier_video&";
        $retour_flash .= "nom_video_$numero=$nom_video&";
        $retour_flash .= "fichier_image1_$numero=$fichier_image1&";
        $retour_flash .= "nom_image1_$numero=$nom_image1&";
        $retour_flash .= "fichier_image2_$numero=$fichier_image2&";
        $retour_flash .= "nom_image2_$numero=$nom_image2&";
        $retour_flash .= "fichier_image3_$numero=$fichier_image3&";
        $retour_flash .= "nom_image3_$numero=$nom_image3&url_article_$numero=$url_article&";        
        $retour_flash .= "texte_$numero=$texte&";
        $retour_flash .= "logo_$numero=$logo&";
                $index++;
</BOUCLE_album0>


<BOUCLE_exclus(RUBRIQUES){id_parent=3}{titre_mot=pas_menu}{tout}{doublons 1}>
</BOUCLE_exclus>

<BOUCLE_rubrique(RUBRIQUES){id_parent=3}{tout}{doublons 1}>
/* récupère les données dans des tableaux gère les slashes */
        $numero = $index;
        $id_article = #ID_RUBRIQUE;
        $titre = stripslashes('#TITRE');
        $date = '#EXTRA';
        $url_article = urlencode('spip.php?rubrique#ID_RUBRIQUE');
        $logo='';
        [$logo = '(#LOGO_RUBRIQUE||image_reduire{50,50}|extraire_attribut{src})';]
        $auteur = '';
        $auteur .= stripslashes('#NOM');
        
        $fichier_image1='';
        $fichier_image2='';
        $fichier_image3='';
        $fichier_son='';
        $fichier_video='';
        $nom_image1='';
        $nom_image2='';
        $nom_image3='';
        $nom_son='';
        $nom_video='';
        
        $type = 2;
        $couleur = 1;
		$texte='';
        <BOUCLE_art(ARTICLES) {id_rubrique} {tout} {par date} {inverse} {0,1}>
        	//$texte = str_replace("\'"," ",$texte);
        	$texte = stripslashes(wordwrap("[(#TEXTE|textebrut|entites_html)]",30));
        
	        <BOUCLE_documents (DOCUMENTS) {id_article} {0,3} {extension==jpg|png|gif}>
	        $type = 1;
	        $couleur = 0;
	        
	        $fichier_image#COMPTEUR_BOUCLE = stripslashes('#URL_DOCUMENT');
	        $nom_image#COMPTEUR_BOUCLE = stripslashes('#TITRE');
	        </BOUCLE_documents>
	        
	        <BOUCLE_documents2 (DOCUMENTS) {id_article} {0,1} {extension==mp3|ogg}>
	        $type = 5;
	        $couleur = 5;
	        
	        $fichier_son = stripslashes('#URL_DOCUMENT');
	        $nom_son = stripslashes('#TITRE');
	        </BOUCLE_documents2>
	        
	        <BOUCLE_documents3 (DOCUMENTS) {id_article} {0,1} {extension==avi|mov|wmv}>
	        $type = 3;
	        $couleur = 2;
	        
	        $fichier_video = stripslashes('#URL_DOCUMENT');
	        $nom_video = stripslashes('#TITRE');
	        </BOUCLE_documents3>

        </BOUCLE_art>
		
		//Couleur connexion
			//$result_auteurs = spip_query("SELECT id_auteur FROM spip_auteurs WHERE id_auteur=#ID_AUTEUR AND en_ligne>DATE_SUB(NOW(),INTERVAL 30 MINUTE)");
			//if (spip_num_rows($result_auteurs)) $couleur = 5;

        /* formatage texte renvoyé à Flash */
        $retour_flash .= "id_$numero=$numero&";
        $retour_flash .= "id_article_$numero=$id_article&";
        $retour_flash .= "auteur_$numero=$auteur&";
        $retour_flash .= "titre_$numero=$titre&";
        $retour_flash .= "type_$numero=$type&";
        $retour_flash .= "couleur_$numero=$couleur&";
        $retour_flash .= "date_$numero=$date&";
        $retour_flash .= "fichier_son_$numero=$fichier_son&";
        $retour_flash .= "nom_son_$numero=$nom_son&";        
        $retour_flash .= "fichier_video_$numero=$fichier_video&";
        $retour_flash .= "nom_video_$numero=$nom_video&";
        $retour_flash .= "fichier_image1_$numero=$fichier_image1&";
        $retour_flash .= "nom_image1_$numero=$nom_image1&";
        $retour_flash .= "fichier_image2_$numero=$fichier_image2&";
        $retour_flash .= "nom_image2_$numero=$nom_image2&";
        $retour_flash .= "fichier_image3_$numero=$fichier_image3&";
        $retour_flash .= "nom_image3_$numero=$nom_image3&url_article_$numero=$url_article&";        
        $retour_flash .= "texte_$numero=$texte&";
        $retour_flash .= "logo_$numero=$logo&";
                $index++;
</BOUCLE_rubrique>

/* ajoute nombre sons */
$nb_total = $index;
$retour_flash .= "total_articles=".$nb_total."&";


/* sortie dans le flux http */
$retour_flash .= "erreur=0";
print(utf8_decode($retour_flash));

/************************************************************************
FIN DU PHP
************************************************************************/
?>
