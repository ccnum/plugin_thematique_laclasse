#CACHE{0}

<?php
/************************************************************************

FRONTOFFICE / MUSIQUE.LACLASSE.COM
DÉBUT DE DÉVELOPPEMENT LE 26/08/2003
HTTP://WWW.LAVITRINEDETRAFIK.COM

LACLASSE.COM / P. VINCENT / ERASME
JUILLET 2006

*************************************************************************
RENVOIE LA LISTE DES ARTICLES - AVEC MOT CLEF PARTICULIER
************************************************************************/

/**********************************
require pour inclure qq fonctions
**********************************/

$retour_flash = "";
$index=0;

<BOUCLE_auteur(AUTEURS) {id_auteur=7}>

/* récupère les données dans des tableaux gère les slashes */
        $numero = $index;
        $id_article = #ID_AUTEUR;
        $titre = stripslashes(utf8_encode('#NOM'));
        $date = '#EXTRA';
        $url_article = 'spip.php?page=par_auteur&id_auteur=#ID_AUTEUR';
        $logo='';
        [$logo = 'IMG/(#LOGO_AUTEUR|fichier)';]
        
        $auteur = '';
        $auteur .= stripslashes('#NOM');
        
        $fichier_image1='';
        $fichier_image2='';
        $fichier_image3='';
        $fichier_son='';
        $fichier_video='';
        $nom_image1='';
        $nom_image2='';
        $nom_image3='';
        $nom_son='';
        $nom_video='';
        
        $type = 2;
        $couleur = 1;

        <BOUCLE_art0(ARTICLES) {id_auteur} {par date} {inverse} {0,1}>
        	//$texte = str_replace("\'"," ",$texte);
        	$texte = stripslashes(wordwrap(utf8_encode("[(#TEXTE|textebrut|entites_html)]"),35));
        
	        <BOUCLE_documents0 (DOCUMENTS) {id_article} {0,3} {extension==jpg|png|gif}>
	        $type = 1;
	        $couleur = 0;
	        
	        $fichier_image#COMPTEUR_BOUCLE = stripslashes('#URL_DOCUMENT');
	        $nom_image#COMPTEUR_BOUCLE = stripslashes('#TITRE');
	        </BOUCLE_documents0>
	        
	        <BOUCLE_documents20 (DOCUMENTS) {id_article} {0,1} {extension==mp3|ogg}>
	        $type = 5;
	        $couleur = 5;
	        
	        $fichier_son = stripslashes('#URL_DOCUMENT');
	        $nom_son = stripslashes('#TITRE');
	        </BOUCLE_documents20>
	        
	        <BOUCLE_documents30 (DOCUMENTS) {id_article} {0,1} {extension==avi|mov|wmv}>
	        $type = 3;
	        $couleur = 2;
	        
	        $fichier_video = stripslashes('#URL_DOCUMENT');
	        $nom_video = stripslashes('#TITRE');
	        </BOUCLE_documents30>

        </BOUCLE_art0>
			
        
        /* formatage texte renvoyé à Flash */
        $retour_flash .= "id_$numero=$numero&";
        $retour_flash .= "id_article_$numero=$id_article&";
        $retour_flash .= "auteur_$numero=$auteur&";
        $retour_flash .= "titre_$numero=$titre&";
        $retour_flash .= "type_$numero=$type&";
        $retour_flash .= "couleur_$numero=$couleur&";
        $retour_flash .= "date_$numero=$date&";
        $retour_flash .= "fichier_son_$numero=$fichier_son&";
        $retour_flash .= "nom_son_$numero=$nom_son&";        
        $retour_flash .= "fichier_video_$numero=$fichier_video&";
        $retour_flash .= "nom_video_$numero=$nom_video&";
        $retour_flash .= "fichier_image1_$numero=$fichier_image1&";
        $retour_flash .= "nom_image1_$numero=$nom_image1&";
        $retour_flash .= "fichier_image2_$numero=$fichier_image2&";
        $retour_flash .= "nom_image2_$numero=$nom_image2&";
        $retour_flash .= "fichier_image3_$numero=$fichier_image3&";
        $retour_flash .= "nom_image3_$numero=$nom_image3&url_article_$numero=$url_article&";        
        $retour_flash .= "texte_$numero=$texte&";
        $retour_flash .= "logo_$numero=$logo&";
        
        $index++;
</BOUCLE_auteur>

[(#REM)On récupère les rubriques objet]

<BOUCLE_rubrique(RUBRIQUES){id_secteur=3}{id_rubrique!=3}>
	/* récupère les données dans des tableaux gère les slashes */
		$numero = $index;
		$titre = stripslashes(utf8_encode('[(#TITRE|textebrut|addslashes)]'));
		$logo='';
		[$logo = '(#LOGO_RUBRIQUE||image_reduire{60,70}|extraire_attribut{src})';]
		$auteur = '';

		$fichier_image1='';
		$fichier_image2='';
		$fichier_image3='';
		$fichier_son='';
		$fichier_video='';
		$nom_image1='';
		$nom_image2='';
		$nom_image3='';
		$nom_son='';
		$nom_video='';
		$id_article = #ID_RUBRIQUE;
		$date = '';
		$type = 2;
		$couleur = 2;
		$texte = '';
			
	<BOUCLE_article(ARTICLES){id_rubrique}{par date}{inverse}{0,1}>
		    $date = '#DATE';
		    $url_article = '[(#URL_PAGE{rubrique}|parametre_url{id_rubrique,#ID_RUBRIQUE}|html_entity_decode|urlencode)]';
		    $texte = stripslashes(wordwrap(utf8_encode('[(#INTRODUCTION|textebrut|addslashes)]'),30));
		    
		    <BOUCLE_mot(spip_mots_articles){id_article}{tout}>
		    <BOUCLE_documents(ARTICLES){id_article=#ID_MOT}{titre_mot=materiau} >
				    $type = 1;
				    $couleur = 0;
				    [$fichier_image#COMPTEUR_BOUCLE = stripslashes('(#LOGO_ARTICLE||extraire_attribut{src})');]
				    $nom_image#COMPTEUR_BOUCLE = stripslashes('#TITRE');
		    </BOUCLE_documents>
		    </BOUCLE_mot>
		    
		    <BOUCLE_documents2 (DOCUMENTS) {id_article} {0,1} {extension==mp3|ogg}>
				    $type = 5;
				    $couleur = 5;        
				    $fichier_son = stripslashes('#URL_DOCUMENT');
				    $nom_son = stripslashes('#TITRE');
		    </BOUCLE_documents2>
		    
		    <BOUCLE_documents3 (DOCUMENTS) {id_article} {0,1} {extension==avi|mov|wmv}>
				    $type = 3;
				    $couleur = 2;        
				    $fichier_video = stripslashes('#URL_DOCUMENT');
				    $nom_video = stripslashes('#TITRE');
		    </BOUCLE_documents3>
		</BOUCLE_article>	    
		    /* formatage texte renvoyé à Flash */
		    $retour_flash .= "id_$numero=$numero&";
		    $retour_flash .= "id_article_$numero=$id_article&";
		    $retour_flash .= "auteur_$numero=$auteur&";
		    $retour_flash .= "titre_$numero=$titre&";
		    $retour_flash .= "type_$numero=$type&";
		    $retour_flash .= "couleur_$numero=$couleur&";
		    $retour_flash .= "date_$numero=$date&";
		    $retour_flash .= "fichier_son_$numero=$fichier_son&";
		    $retour_flash .= "nom_son_$numero=$nom_son&";        
		    $retour_flash .= "fichier_video_$numero=$fichier_video&";
		    $retour_flash .= "nom_video_$numero=$nom_video&";
		    $retour_flash .= "fichier_image1_$numero=$fichier_image1&";
		    $retour_flash .= "nom_image1_$numero=$nom_image1&";
		    $retour_flash .= "fichier_image2_$numero=$fichier_image2&";
		    $retour_flash .= "nom_image2_$numero=$nom_image2&";
		    $retour_flash .= "fichier_image3_$numero=$fichier_image3&";
		    $retour_flash .= "nom_image3_$numero=$nom_image3&url_article_$numero=$url_article&";        
		    $retour_flash .= "texte_$numero=$texte&";
		    $retour_flash .= "logo_$numero=$logo&";
		    
		    $index++;

</BOUCLE_rubrique>

/* ajoute nombre sons */
$nb_total = $index+1	;
$retour_flash .= "total_articles=".$nb_total."&";


/* sortie dans le flux http */
$retour_flash .= "erreur=0";
print(utf8_decode($retour_flash));

/************************************************************************
FIN DU PHP
************************************************************************/
?>
